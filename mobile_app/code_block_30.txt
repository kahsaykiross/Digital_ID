import 'package:flutter/material.dart'; import '../services/api_service.dart'; import 'upload_screen.dart'; import 'package:provider/provider.dart'; import '../providers/auth_provider.dart'; class LoginScreen extends StatefulWidget { @override _LoginScreenState createState() => _LoginScreenState(); } class _LoginScreenState extends State<LoginScreen> { final _formKey = GlobalKey<FormState>(); String nationalId = '', password = ''; String message = ''; @override Widget build(BuildContext context) { final authProvider = Provider.of<AuthProvider>(context); return Scaffold( appBar: AppBar(title: Text('Login')), body: Padding( padding: EdgeInsets.all(16), child: Form( key: _formKey, child: Column( children: [ TextFormField( decoration: InputDecoration(labelText: 'National ID'), onChanged: (val) => nationalId = val, validator: (val) => val!.isEmpty ? 'Required' : null, ), TextFormField( decoration: InputDecoration(labelText: 'Password'), onChanged: (val) => password = val, obscureText: true, validator: (val) => val!.isEmpty ? 'Required' : null, ), SizedBox(height: 20), ElevatedButton( onPressed: () async { if (_formKey.currentState!.validate()) { var res = await ApiService.loginUser({ 'nationalId': nationalId, 'password': password }); if (res['token'] != null) { await authProvider.saveToken(res['token'], res['token']); // userId placeholder Navigator.pushReplacement(context, MaterialPageRoute(builder: (_) => UploadScreen())); } else { setState(() { message = res['message']; }); } } }, child: Text('Login'), ), SizedBox(height: 10), Text(message) ], ), ), ), ); } }