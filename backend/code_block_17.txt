const Document = require('../models/document'); const multer = require('multer'); const path = require('path'); const storage = multer.diskStorage({ destination: function(req, file, cb) { cb(null, 'uploads/'); }, filename: function(req, file, cb) { cb(null, Date.now() + path.extname(file.originalname)); } }); const upload = multer({ storage }); exports.uploadDocument = [ upload.single('file'), async (req, res) => { try { const { userId, type } = req.body; if (!req.file || !userId || !type) return res.status(400).json({ message: 'Missing required data' }); const doc = await Document.create({ userId, type, filePath: req.file.path }); res.status(201).json({ message: 'Document uploaded', document: doc }); } catch (err) { console.error(err); res.status(500).json({ message: 'Upload failed' }); } } ];